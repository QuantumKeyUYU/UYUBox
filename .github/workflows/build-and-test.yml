name: Build & Test

on:
  push:
    branches:
      - fix/ci-no-build-isolation
  pull_request:
    branches:
      - fix/ci-no-build-isolation

jobs:
  build-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Detect BOM/UTF-16 signatures
        run: |
          echo "‚îå‚îÄ‚îÄ –°—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ BOM/UTF-16"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ .py, .md –∏ .toml —Ñ–∞–π–ª—ã
          find . -type f \( -name '*.py' -o -name '*.md' -o -name '*.toml' \) | while read -r f; do
            # –°—á–∏—Ç—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 3 –±–∞–π—Ç–∞
            sig=$(xxd -p -l 3 "$f" | tr '[:lower:]' '[:upper:]')
            
            # –†–æ–Ω—è–µ–º –≤–µ—Å—å workflow, –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º BOM
            if [[ "$sig" == "EFBBBF"* ]]; then
              echo "üí• BOM UTF-8   -> $f"
              exit 1
            elif [[ "$sig" == "FEFF"* ]]; then
              echo "üí• BOM UTF-16BE -> $f"
              exit 1
            elif [[ "$sig" == "FFFE"* ]]; then
              echo "üí• BOM UTF-16LE -> $f"
              exit 1
            fi
          done
          
          echo "‚úîÔ∏è –í—Å–µ —Ñ–∞–π–ª—ã —á–∏—Å—Ç—ã ‚Äî –Ω–∏ –æ–¥–Ω–æ–≥–æ BOM –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
