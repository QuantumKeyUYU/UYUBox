# .github/workflows/ci.yml
name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    name: Build & Test on Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        python-version: [ '3.9', '3.10', '3.11' ]

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v3

      - name: üîß Setup Python ${{ matrix.python-version }}
        uses: actions/setup-python@v4
        with:
          python-version: ${{ matrix.python-version }}

      - name: üì¶ Upgrade pip, setuptools & wheel
        run: |
          python -m pip install --upgrade pip setuptools wheel

      - name: ‚öôÔ∏è Install dev dependencies
        run: |
          # —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ editable-—Ä–µ–∂–∏–º–µ, –±–µ–∑ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è PEP 517
          python -m pip install --upgrade build
          python -m build --wheel --outdir dist .
          python -m pip install dist/*.whl[dev]

      - name: ‚úÖ Run tests
        run: |
          python -m pytest --maxfail=1 --disable-warnings -q

      - name: üêç Lint with flake8
        run: |
          python -m pip install flake8
          # —è–≤–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç strip_bom.py
          flake8 src --exclude strip_bom.py

      - name: üîí Security scan with Bandit
        run: |
          python -m pip install bandit
          bandit -r src --exclude strip_bom.py
