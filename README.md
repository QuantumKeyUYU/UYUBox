# Zilant Prime Mobile

Zilant Prime Mobile — это минималистичное Android‑приложение, использующее ядро `zilant-prime-core` для безопасной упаковки и распаковки файлов в контейнер `.zil`. Проект написан на Python с помощью Kivy MD и может быть собран в APK с помощью Buildozer. Приложение шифрует все входящие данные при помощи Argon2id‑KDF и AES‑GCM из пакета `zilant-prime-core`, добавляет соль в мета‑информацию контейнера и обеспечивает просмотр метаданных контейнера без расшифровки содержимого.

## Основные возможности

* **Упаковка файла** — выберите исходный файл, задайте пароль и имя выходного контейнера. Приложение генерирует случайную соль, derivирует 32‑байтный ключ через Argon2id, шифрует файл и добавляет к метаданным контейнера поле `salt_hex` и оригинальное имя файла. 
* **Распаковка файла** — выберите файл `.zil`, укажите папку для сохранения и пароль. Приложение извлечёт метаданные контейнера, получит соль, derivирует ключ и расшифрует содержимое. Поддерживаются только классические контейнеры (`mode=classic`), но код легко расширить.
* **Просмотр метаданных** — без расшифровки показывает JSON‑метаданные контейнера: размер, контрольную сумму, режим, имя файла, соль и прочие поля.
* **Удобный интерфейс** — лаконичный дизайн на основе Material Design; файловый менеджер для выбора входных и выходных путей; всплывающие окна для ввода пароля и сообщений об успехе/ошибках.
* **Безопасность** — используется только поддерживаемые и устойчивые криптографические библиотеки (`argon2‑cffi`, `cryptography`, `zilant‑prime‑core`), Argon2id с ограниченным объёмом памяти, шифрование AES‑GCM и минимальные разрешения Android. В `buildozer.spec` включены ProGuard/Мinify для обфускации, отключён `android.debug`, в манифесте запрошены только `READ_EXTERNAL_STORAGE` и `WRITE_EXTERNAL_STORAGE`.

## Структура проекта

```
android_zilant_app/
├── main.py               # Точка входа Kivy MD; определяет интерфейс и логику упаковки/распаковки
├── requirements.txt      # Зависимости Python для запуска на десктопе и сборки в APK
├── buildozer.spec        # Конфигурация Buildozer для сборки APK/АAB
├── proguard-rules.pro    # Дополнительные правила ProGuard для обфускации и минимизации
├── .gitignore            # Исключения Git
└── README.md             # Этот файл — описание и инструкция
```

### Файл `main.py`

*Содержит класс `ZilantMobileApp`, наследующий `MDApp`. Приложение строит основной экран с тремя кнопками: «Упаковать файл», «Распаковать файл» и «Метаданные контейнера».*
* Для выбора файлов используется `MDFileManager`; для ввода пароля и имени файла — `MDDialog` с полями `MDTextField`. Весь функционал упакован в отдельные методы: `do_pack()`, `do_unpack()` и `show_metadata()`. Для derivирования ключа используется функция `derive_key()` (Argon2id с ограниченными параметрами), чтобы сохранить баланс между скоростью и безопасностью на мобильных устройствах. Все операции по шифрованию выполняются через функции `pack_file()` и `unpack_file()` из `zilant_prime_core.container`.*

### Файл `requirements.txt`

Содержит список зависимостей для проекта:

```
kivy>=2.2.0
kivymd>=1.2.0
argon2-cffi>=23.1.0
cryptography>=42.0.0
zilant-prime-core>=0.7.0
``` 

Эти библиотеки устанавливаются автоматически при сборке APK через Buildozer. На обычном компьютере для разработки вы можете установить их вручную: `pip install -r requirements.txt`.

### Файл `buildozer.spec`

Определяет конфигурацию Buildozer. Важные параметры:

* **title/package.name/package.domain** — идентификаторы приложения; их можно менять, но придерживайтесь обратной записи домена.
* **requirements** — список библиотек, которые следует включить в APK (включая Python версии, Kivy, KivyMD, argon2‑cffi, cryptography и сам `zilant-prime-core`).
* **android.permissions** — только необходимые разрешения чтения/записи внешнего хранилища. Уберите лишние разрешения, если они вам не нужны.
* **android.proguard** и `android.add_proguard_rules` — включают обфускацию, сокращение кода и подгружают дополнительные правила из файла `proguard-rules.pro`.
* **android.release** — по умолчанию `False`. Для генерации release‑сборки измените на `True` и подпишите APK вручную.

### Файл `proguard-rules.pro`

Добавляет несколько правил для корректной работы Kivy и скрытия имен классов. В частности, сохраняет основные классы PythonActivity, необходимые для запуска интерпретатора, и запрещает ProGuard опускать критические классы. Вы можете расширять правила для более глубокой обфускации.

### Файл `.gitignore`

Исключает временные файлы (`__pycache__`, `*.pyc`), каталоги сборки, артефакты APK/AAB и виртуальные окружения.

## Шаги сборки APK

Сборка приложения возможна только на Linux/macOS или в среде WSL2 для Windows. Buildozer не поддерживается напрямую на чистом Windows. Ниже приведены шаги для Linux и Windows (WSL).

### 1. Установка зависимостей (Linux/WSL)

1. Установите Python 3.10+ и pip:

   ```bash
   sudo apt update
   sudo apt install -y python3 python3-pip git build-essential zlib1g-dev libncurses5 libffi-dev libssl-dev libsqlite3-dev openjdk-11-jdk unzip
   python3 -m pip install --upgrade pip
   ```

2. Установите Buildozer и Cython в пользовательский каталог:

   ```bash
   python3 -m pip install --user cython buildozer virtualenv
   ```

3. Создайте и активируйте виртуальное окружение (рекомендуется):

   ```bash
   python3 -m venv venv
   source venv/bin/activate
   pip install --upgrade pip
   pip install -r requirements.txt
   ```

### 2. Подготовка Buildozer

1. В корне проекта (`android_zilant_app/`) уже находится файл `buildozer.spec`. Buildozer автоматически создаст недостающие каталоги при первом запуске.
2. Чтобы автоматически загрузить Android SDK/NDK и собрать debug‑версию APK, выполните:

   ```bash
   buildozer -v android debug
   ```

   Первая сборка может занимать до часа и потребует скачивания нескольких гигабайт. Buildozer установит все необходимые инструменты в каталог `~/.buildozer/`.

3. Готовый `apk` будет находиться в каталоге `bin/` (например, `android_zilant_app/bin/ZilantMobile-0.1-debug.apk`). Установите его на устройство:

   ```bash
   adb install -r bin/ZilantMobile-0.1-debug.apk
   ```

### 3. Сборка release‑версии и подпись

1. В файле `buildozer.spec` установите `android.release = True` (или добавьте параметр `--release` к команде Buildozer) для генерации unsigned‑release APK.
2. Сгенерируйте keystore для подписи (один раз):

   ```bash
   keytool -genkey -v -keystore zilant-release.jks -alias zilantkey -keyalg RSA -keysize 4096 -validity 10000
   ```

3. Соберите unsigned‑release APK:

   ```bash
   buildozer -v android release
   ```

4. Подпишите и выровняйте APK:

   ```bash
   jarsigner -verbose -keystore zilant-release.jks bin/ZilantMobile-0.1-release-unsigned.apk zilantkey
   zipalign -v 4 bin/ZilantMobile-0.1-release-unsigned.apk ZilantMobile-0.1-release.apk
   ```

### 4. Дополнительные замечания

* **Минимизация разрешений** — если вам не требуется доступ к файлам вне каталога приложения, удалите `READ_EXTERNAL_STORAGE` и `WRITE_EXTERNAL_STORAGE` из `buildozer.spec`.
* **Дополнительные фичи** — библиотека `zilant-prime-core` содержит множество функций ( SecureLogger, Pseudo‑HSM, decoy‑режим и т.д.). При желании вы можете расширить приложение, импортируя и вызывая необходимые функции из модуля `zilant_prime_core`.
* **WSL/Windows** — установите Ubuntu в WSL2, выполните шаги установки и сборки внутри окружения WSL. Затем перенесите полученный APK в Windows и установите его на устройство.

## Что делать, если сборка не удалась

* **Проблемы с зависимостями** — убедитесь, что у вас установлены все системные пакеты (Java JDK, пакеты dev‑заголовков). Иногда помогает удаление каталога `~/.buildozer` и повторный запуск.
* **Ошибки NDK** — обновите параметр `android.ndk` в `buildozer.spec` до актуальной версии (например, `25.2.9519653`). Buildozer должен автоматически скачивать подходящую версию.
* **Производительность** — параметры Argon2id по умолчанию в репозитории используют 500 МиБ памяти, что неприемлемо для мобильных устройств. В приложении параметры снижены до 64 МиБ, что обеспечивает приемлемую скорость на телефонах. При необходимости уменьшайте или увеличивайте `MEMORY_COST` и `TIME_COST` в функции `derive_key()` в `main.py`.

## Лицензия

Проект распространяется под лицензией MIT. Обращайтесь к файлу `LICENSE` в корне репозитория `zilant-prime-core` для деталей. Все авторские права сохраняются за участниками `QuantumKeyUYU/zilant-prime-core`.